---
name: ðŸ§ª Test Asset Crusher Logic
on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  crush-assets:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v6

      - name: ðŸ›  Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg webp

      - name: ðŸ¦¾ Run Compression Logic
        run: |
          echo "ðŸ”Ž Starting the hunt for heavy assets..."

          find . -type f \( -name "*.jpg" -o -name "*.jpeg" -o -name "*.png" \) -not -path "*/.git/*" | while read img; do
            echo "ðŸ”¥ Crushing Image: $img"
            
            cwebp -q 75 "$img" -o "${img%.*}.webp"
            
            rm "$img"
            echo "âœ… Converted to ${img%.*}.webp"
          done

          find . -type f -name "*.mp4" -not -path "*/.git/*" | while read vid; do
            echo "ðŸŽ¬ Crushing Video: $vid"
            
            mv "$vid" "temp_original.mp4"
            
            ffmpeg -i "temp_original.mp4" -vcodec libx265 -crf 28 "$vid"
            
            rm "temp_original.mp4"
            echo "âœ… Video Optimized: $vid"
          done

      - name: ðŸ’¾ Commit & Push Changes
        run: |
          git config --global user.name "Crusher-Test-Bot"
          git config --global user.email "bot@test.com"
          
          if [[ -n $(git status -s) ]]; then
            git add .
            git commit -m "ðŸ“‰ Assets Crushed via GitHub Actions [skip ci]"
            git push
            echo "ðŸš€ Pushed optimized assets to repo."
          else
            echo "ðŸ’¤ No assets needed crushing."
          fi
